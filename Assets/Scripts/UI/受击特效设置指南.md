# 🎆 受击特效系统设置指南

## 📋 系统概述

我们新增了以下系统来解决游戏中缺乏视觉反馈的问题：

1. **受击特效系统** - 角色被攻击时的闪烁和震动效果
2. **伤害数字显示** - 头顶浮动的伤害数值
3. **屏幕震动效果** - 摄像机震动反馈
4. **死亡事件修复** - 确保死亡正确触发

## 🔧 Unity中的设置步骤

### 1. 设置伤害数字管理器

1. **创建DamageNumberManager**：
   - 在场景中创建空物体，命名为 "DamageNumberManager"
   - 添加 `DamageNumberManager` 脚本

2. **创建伤害数字预制体**：
   ```
   - 创建空物体，命名为 "DamageNumber"
   - 添加 DamageNumber 脚本
   - 子物体中添加 TextMeshPro 组件
   - 保存为预制体到 Assets/Prefabs/ 目录
   - 将预制体拖拽到 DamageNumberManager 的 "Damage Number Prefab" 字段
   ```

### 2. 为玩家添加特效系统

**玩家对象需要的组件**：
- `PlayerController` ✅ (已有)
- `HealthSystem` ⚠️ (需要添加)
- `HitEffect` 🆕 (新增)
- `SpriteRenderer` ✅ (已有)

**设置步骤**：
1. 选中玩家对象
2. 添加 `HealthSystem` 组件，设置血量值
3. 添加 `HitEffect` 组件
4. 确保玩家对象标签为 "Player"

### 3. 为敌人添加特效系统

**敌人对象需要的组件**：
- `EnemyAI` ✅ (已有)
- `HealthSystem` ✅ (已有)  
- `HitEffect` 🆕 (新增)
- `SpriteRenderer` ✅ (已有)

**设置步骤**：
1. 打开敌人预制体
2. 添加 `HitEffect` 组件
3. 确保敌人对象标签为 "Enemy"

### 4. 设置摄像机震动

1. **主摄像机设置**：
   - 选中主摄像机 (Main Camera)
   - 添加 `CameraShake` 脚本
   - 调整震动参数：
     - Default Duration: 0.2
     - Default Intensity: 0.3
     - Enable Screen Shake: ✓

## ⚙️ 参数调整建议

### HitEffect 参数
- **Flash Duration**: 0.2秒 (闪烁持续时间)
- **Flash Count**: 3次 (闪烁次数)  
- **Flash Color**: 红色 (受伤闪烁颜色)
- **Shake Duration**: 0.15秒 (个体震动时间)
- **Shake Intensity**: 0.1 (个体震动强度)

### CameraShake 参数
- **轻微震动** (玩家受伤): 0.15秒, 0.1强度
- **中等震动** (敌人死亡): 0.25秒, 0.2强度
- **强烈震动** (大爆炸): 0.4秒, 0.4强度

### DamageNumber 参数
- **Lifetime**: 1.5秒 (数字显示时长)
- **Move Speed**: 2 (向上漂浮速度)
- **Font Size**: 3 (文字大小)

## 🎨 颜色配置

### 伤害数字颜色
- **玩家受伤**: 红色 (#FF0000)
- **敌人受伤**: 黄色 (#FFFF00)  
- **治疗数字**: 绿色 (#00FF00)

### 闪烁颜色
- **玩家受伤闪烁**: 红色
- **敌人受伤闪烁**: 白色或红色

## 🔍 测试检查列表

运行游戏后检查以下效果：

- [ ] 玩家被敌人攻击时：
  - [ ] 玩家角色闪烁红色
  - [ ] 显示红色伤害数字
  - [ ] 屏幕轻微震动
  - [ ] 血量为0时玩家死亡重生

- [ ] 飞剑攻击敌人时：
  - [ ] 敌人角色闪烁
  - [ ] 显示黄色伤害数字  
  - [ ] 血量为0时敌人死亡消失
  - [ ] 分数系统增加击杀数

- [ ] 伤害数字效果：
  - [ ] 数字向上漂浮
  - [ ] 逐渐淡出消失
  - [ ] 不同伤害类型颜色正确

## 🐛 常见问题解决

### 问题1: 伤害数字不显示
**解决方案**：
- 检查 DamageNumberManager 是否存在于场景中
- 确保设置了伤害数字预制体
- 检查 TextMeshPro 是否正确配置

### 问题2: 角色不闪烁
**解决方案**：
- 确保添加了 HitEffect 组件
- 检查对象是否有 SpriteRenderer 组件
- 确认 HealthSystem 正确订阅了受伤事件

### 问题3: 屏幕不震动
**解决方案**：
- 检查主摄像机是否添加了 CameraShake 组件
- 确认 Enable Screen Shake 已勾选
- 调高震动强度参数

### 问题4: 死亡事件不触发
**解决方案**：
- 确保 PlayerController 和 EnemyAI 都正确订阅了 HealthSystem.OnDeath 事件
- 检查血量是否真的降到0或以下
- 查看Console日志确认死亡触发

## 📝 性能优化建议

1. **伤害数字限制**: 同时显示的伤害数字不超过20个
2. **特效复用**: 使用对象池管理伤害数字预制体
3. **震动节制**: 避免同时触发多个强烈震动
4. **闪烁优化**: 大量敌人同时受伤时考虑减少闪烁效果

---

✨ **设置完成后，你的游戏将拥有丰富的视觉反馈效果！**
